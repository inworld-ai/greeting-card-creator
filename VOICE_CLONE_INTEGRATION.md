# Voice Clone API Integration

This document describes the new voice clone API integration that allows users to create custom narrators without needing an Inworld account.

## Overview

Users can now record a 10-15 second audio sample directly in the browser, and the voice will be cloned instantly using Inworld's Voice Clone API. The cloned voice is stored in the `christmas_story_generator` workspace and can be used immediately for story narration.

## Architecture

### Backend (`/api/clone-voice`)

- **Endpoint**: `POST /api/clone-voice`
- **Authentication**: Uses `INWORLD_PORTAL_API_KEY` (Portal API key, different from standard API key)
- **Workspace**: All voices are cloned into `workspaces/christmas_story_generator`
- **Request Body**:
  ```json
  {
    "audioData": "base64-encoded-audio",
    "displayName": "User's Voice Name",
    "langCode": "EN_US",
    "transcription": "optional"
  }
  ```
- **Response**:
  ```json
  {
    "voiceId": "christmas_story_generator__voice_name",
    "voiceName": "workspaces/christmas_story_generator/voices/voice_name",
    "displayName": "User's Voice Name",
    "warnings": [],
    "errors": [],
    "transcription": "detected transcription"
  }
  ```

### Frontend (`CustomNarrator.tsx`)

- **Recording**: Uses browser `MediaRecorder` API (works on mobile)
- **Format**: Records as WebM/Opus, converts to base64 for API
- **Duration**: Auto-stops at 15 seconds (API limit)
- **Validation**: Shows warnings/errors from API response
- **Flow**: Record ‚Üí Name ‚Üí Clone ‚Üí Use Immediately

## Environment Variables

Add to `.env`:
```env
INWORLD_PORTAL_API_KEY=your_portal_api_key_here
```

**Important**: This is different from `INWORLD_API_KEY`. The Portal API key is required for voice cloning and is only available to users with preview access.

## User Experience

### Easy Flow (Voice Clone)
1. User clicks "Create Your Own Narrator"
2. Selects "üéôÔ∏è Record Voice Clone (Easy)"
3. Clicks "Start Recording"
4. Speaks for 10-15 seconds
5. Reviews audio playback
6. Enters a name for the voice
7. Clicks "Clone Voice & Create Story"
8. Voice is cloned and used immediately

### Advanced Flow (Manual Entry)
1. User clicks "Create Your Own Narrator"
2. Selects "üîë Use Existing Voice (Advanced)"
3. Enters Inworld API Key and Voice ID
4. Creates story with existing voice

## Benefits

- ‚úÖ **No Account Required**: Users don't need to sign up for Inworld
- ‚úÖ **No Workspace Setup**: All voices go to Inworld's workspace
- ‚úÖ **Instant Use**: Voice is ready immediately after cloning
- ‚úÖ **Mobile Friendly**: Browser MediaRecorder works on mobile devices
- ‚úÖ **Background Noise Removal**: Enabled by default for better quality

## Technical Details

### Audio Processing
- **Input Format**: WebM/Opus (from MediaRecorder)
- **API Format**: Base64-encoded WAV or MP3
- **Duration**: 10-15 seconds recommended (15s max)
- **Background Noise**: Removed by default via `audioProcessingConfig.removeBackgroundNoise: true`

### Voice ID Format
Cloned voices use the format: `christmas_story_generator__{voice_name}`

The voice name is generated by Inworld based on the display name provided.

## Error Handling

- **Microphone Access**: Shows error if browser permissions denied
- **API Errors**: Displays validation errors from Inworld API
- **Network Errors**: Shows user-friendly error messages
- **Validation Warnings**: Logged to console, don't block usage

## Future Enhancements

- File upload option (in addition to recording)
- Multiple language support
- Voice preview before cloning
- Edit/delete cloned voices

